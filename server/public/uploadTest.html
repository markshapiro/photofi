<html>

<head>
  <meta charset="utf-8">
  <title>Redux Easy Boilerplate</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/png" href="./src/images/favicon.png"/>
</head>

<body>
  <div id="root"></div>
</body>



<script>

  /*
  * minimize image to max 500px width or height and then upload to cloudinary using temp api credentials
  * */

  var sampleImage="http://imgsv.imaging.nikon.com/lineup/lens/zoom/normalzoom/af-s_dx_18-140mmf_35-56g_ed_vr/img/sample/sample1_l.jpg";

  var img = new Image();
  var MAX_SIZE = 500;
  img.setAttribute('crossOrigin', 'anonymous');
  img.onload = function () {
    var canvas = document.createElement('canvas'),
            width = img.width,
            height = img.height;
    if (width > height) {
      if (width > MAX_SIZE) {
        height *= MAX_SIZE / width;
        width = MAX_SIZE;
      }
    } else {
      if (height > MAX_SIZE) {
        width *= MAX_SIZE / height;
        height = MAX_SIZE;
      }
    }
    canvas.width = width;
    canvas.height = height;
    canvas.getContext('2d').drawImage(img, 0, 0, width, height);

    var dataURL = canvas.toDataURL("image/jpg", 0.8);

    var url= "https://api.cloudinary.com/v1_1/linux4biz/image/upload";

    var fd = new FormData();

    var sendCredentials={
      "timestamp": 1485059050,
      "transformation": "c_limit,h_500,w_500",
      "signature": "2e608222ddf7bad325485009b5934864725a1f48",
      "api_key": "846588269727119"
    };

    fd.append("timestamp", sendCredentials.timestamp);
    fd.append("signature", sendCredentials.signature);
    fd.append("api_key", sendCredentials.api_key);
    fd.append("transformation", sendCredentials.transformation);

    fd.append("file", dataURL);

    var xhr = new XMLHttpRequest();
    xhr.open('POST', url, true);

    xhr.upload.onprogress = function(e) {
      if (e.lengthComputable) {
        var percentComplete = (e.loaded / e.total) * 100;
        console.log(percentComplete + '% uploaded');
      }
    };

    xhr.onload = function() {
      if (this.status == 200) {
        var resp = JSON.parse(this.response);
        console.log("uploaded successfuly")
      };
    };

    xhr.send(fd);
  };
  img.onerror = function () {
    console.log("error");
  };
  img.src = sampleImage;

</script>


</html>
